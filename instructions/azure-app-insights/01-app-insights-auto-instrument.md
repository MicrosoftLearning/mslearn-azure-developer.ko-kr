---
lab:
  topic: Application Insights
  title: 자동 계측을 사용하여 애플리케이션 모니터링하기
  description: '자동 계측을 구성하여 코드를 수정하지 않고 Application Insights에서 애플리케이션을 모니터링하는 방법을 알아보세요. '
---

# 자동 계측을 사용하여 애플리케이션 모니터링하기

이 연습에서는 Application Insights를 활성화한 Azure App Service 웹앱을 만들고, 코드를 수정하지 않고 자동 계측을 구성하여, Blazor 애플리케이션을 만들고 배포한 다음, Application Insights에서 애플리케이션 메트릭과 오류 데이터를 확인해 보세요. 코드를 변경하지 않고도 포괄적인 애플리케이션 모니터링 및 관찰 기능을 구현하면 배포 및 마이그레이션이 더 간단해집니다.

이 연습에서 수행된 작업:

* Application Insights를 활성화하여 웹앱 리소스 만들기
* 웹앱에 대한 계측을 구성합니다.
* 새로운 Blazor 앱을 만들고 웹앱 리소스에 배포합니다.
* Application Insights에서 애플리케이션 활동 보기
* 리소스 정리

이 연습을 완료하는 데 약 **20**분이 걸립니다.

## Azure에서 리소스 만들기

1. 브라우저에서 Azure Portal[https://portal.azure.com](https://portal.azure.com)로 이동한 다음, 메시지가 나타나면 Azure 자격 증명을 사용하여 로그인합니다.
1. 홈페이지 위쪽의 **Azure Services** 제목에 있는 **+ 리소스 만들기**를 선택합니다. 
1. **Marketplace 검색** 창에서 *web app*을 입력하고 **enter** 키를 눌러 검색을 시작합니다.
1. 웹앱 타일에서 **만들기** 드롭다운을 선택한 다음, **Web App**을 선택합니다.

    ![Web App 타일의 스크린샷.](./media/create-web-app-tile.png)

**만들기**를 선택하면 배포에 대한 정보를 입력할 수 있는 몇 가지 탭이 있는 템플릿이 열립니다. 다음 단계에서는 관련 탭에서 변경해야 하는 사항을 안내합니다.

1. **Basics** 탭에 다음 표에 포함된 정보를 입력합니다.

    | 설정 | 작업 |
    |--|--|
    | **구독** | 기본값을 유지합니다. |
    | **리소스 그룹** | 새로 만들기를 선택하고 `rg-WebApp`을(를) 입력한 다음, 확인을 선택합니다. 원한다면 기존 리소스 그룹을 선택할 수도 있습니다. |
    | **이름** | 고유한 이름(예: **YOUR-INITIALS-monitorapp**)을 입력하세요. **YOUR-INITIALS**를 자신의 이니셜이나 다른 값으로 바꿔 입력하세요. 이름은 고유해야 하므로 몇 가지 변경이 필요할 수 있습니다. |
    | **이름** 설정 아래의 슬라이더 | 슬라이더를 선택하여 끕니다. 이 슬라이더는 일부 Azure 구성에만 나타납니다. |
    | **게시** | **코드** 옵션을 선택하세요. |
    | **런타임 스택** | 드롭다운 메뉴에서 **.NET 8(LTS)** 을 선택합니다. |
    | **운영 체제** | **Windows**를 선택합니다. |
    | **지역** | 기본 선택을 유지하거나 가까운 지역을 선택합니다. |
    | **Windows 플랜** | 기본 선택을 유지합니다. |
    | **요금제** | 드롭다운을 선택하고 **Free F1** 플랜을 선택합니다. |

1. **모니터링 + 보안** 탭을 선택하거나 탐색하여 다음 표에 정보를 입력합니다.

    | 설정 | 작업 |
    |--|--|
    | **Application Insights 사용** | **예**를 선택합니다. |
    | **Application Insights** | **새로 만들기**를 선택하면 대화 상자가 나타납니다. 대화 상자의 **이름** 필드에 `autoinstrument-insights`를 입력합니다. 그런 다음, **확인**을 선택하여 이름을 적용합니다. |
    | **작업 영역** | 필드가 아직 입력되지 않았고 잠겨 있지 않은 경우, `Workspace`를 입력하세요. |

1. **검토 + 만들기**를 선택하고 배포 세부 정보를 검토하세요. 그런 다음, **만들기**를 선택하여 리소스를 만듭니다.

배포가 완료되려면 몇 분 정도 걸립니다. 완료되면 **리소스로 이동** 단추를 선택하세요.

### 계측 설정 구성

코드를 변경하지 않고 모니터링을 활성화하려면 서비스 수준에서 앱에 대한 계측을 구성해야 합니다.

1. 왼쪽 탐색 메뉴에서 **모니터링**을 확장하고 **Application Insights**를 선택하세요.

1. **애플리케이션 계측** 섹션을 찾아 **.NET Core**를 선택하세요.

1. **컬렉션 수준** 섹션에서 **맞춤**을 선택하세요.

1. **적용**을 선택한 다음, 변경 내용을 확인하세요.

1. 왼쪽 탐색 메뉴에서 **개요**를 선택하세요.

## Blazor 앱 만들기 및 배포

이 연습 섹션에서는 Cloud Shell에서 Blazor 앱을 만들고, 만든 웹앱에 배포합니다. 이 섹션의 모든 단계는 Cloud Shell 수행됩니다.

1. 페이지 상단의 검색 창 오른쪽에 있는 **[\>_]** 단추를 사용하여 Azure Portal에서 새 Cloud Shell을 만들고 ***Bash*** 환경을 선택합니다. Cloud Shell은 다음과 같이 Azure Portal 아래쪽 창에 명령줄 인터페이스를 제공합니다. 파일을 보관할 스토리지 계정을 선택하라는 프롬프트가 표시되면 **스토리지 계정 필요 없음**, 구독을 차례로 선택한 다음, **적용**을 선택합니다.

    > **참고**: 이전에 *PowerShell* 환경을 사용하는 Cloud Shell을 만든 경우 ***Bash***로 전환합니다.

1. 다음 명령을 실행하여 Blazor 앱을 위한 디렉터리를 만들고 해당 디렉터리로 이동합니다.

    ```
    mkdir blazor
    cd blazor
    ```

1. 다음 명령을 실행하여 폴더에 새 Blazor 앱을 만듭니다.

    ```
    dotnet new blazor
    ```

1. 다음 명령을 실행하여 애플리케이션을 빌드하고, 만드는 동안 문제가 발생하지 않도록 합니다.

    ```
    dotnet build
    ```

### App Service에 앱 배포

앱을 배포하려면 먼저 **dotnet publish** 명령을 사용하여 앱을 게시한 다음, 배포를 위한 *.zip* 파일을 만들어야 합니다.

1. 다음 명령을 실행하여 앱을 *publish* 디렉터리에 게시합니다.

    ```
    dotnet publish -c Release -o ./publish
    ```

1. 게시된 앱의 *.zip* 파일을 생성하려면 다음 명령을 실행하세요. *.zip* 파일은 애플리케이션의 루트 디렉터리에 있습니다.

    ```
    cd publish
    zip -r ../app.zip .
    cd ..
    ```

1. 다음 명령을 실행하여 App Service에 앱을 배포합니다. 연습에서 App Service 리소스를 만들 때 사용한 값으로 **YOUR-WEB-APP-NAME** 및 **YOUR-RESOURCE-GROUP**을 바꿔 입력하세요.

    ```
    az webapp deploy --name YOUR-WEB-APP-NAME \
        --resource-group YOUR-RESOURCE-GROUP \
        --src-path ./app.zip
    ```

1. 배포가 완료되면, **Essentials** 섹션에 있는 **기본 도메인** 필드의 링크를 선택하여 브라우저의 새 탭에서 앱을 열어보세요.

이제 Application Insights에서 몇 가지 기본적인 애플리케이션 메트릭을 살펴볼 차례입니다. 이 탭을 닫지 마세요. 연습의 나머지 부분에서 이 탭을 사용할 예정입니다.

## Application Insights에서 메트릭 보기

Azure Portal 탭으로 돌아가서 앞서 만든 Application Insights 리소스로 이동하세요. **개요** 탭에는 몇 가지 기본 차트가 표시됩니다.

* 실패한 요청
* 서버 응답 시간
* 서버 요청
* 가용성

이 섹션에서는 웹앱에서 몇 가지 작업을 수행한 다음, 이 페이지로 돌아가 활동을 확인합니다. 활동 보고가 지연되므로 차트에 나타나기까지 몇 분 정도 걸릴 수 있습니다.

웹앱에서 다음 단계를 수행하세요.

1. 웹앱 메뉴에서 **홈**, **+ 카운터**, **날씨** 탐색 옵션을 탐색합니다.

1. 웹 페이지를 여러 번 새로 고쳐서 **서버 응답 시간** 및 **서버 요청** 데이터를 생성합니다.

1. 일부 오류를 생성하려면 **홈** 단추를 선택한 다음, URL에 **/failures**를 추가하세요. 이 경로는 웹앱에 없으므로 오류가 발생합니다. 오류 데이터를 생성하려면 페이지를 여러 번 새로 고침하세요.

1. Application Insights가 실행 중인 탭으로 돌아가서 차트에 정보가 표시될 때까지 1~2분 정도 기다립니다. 

1. 왼쪽 탐색에서 **조사** 섹션을 확장한 후, **실패**를 선택하세요. 실패한 요청 수와 함께 실패에 대한 응답 코드의 보다 자세한 정보가 표시됩니다.

다른 보고 옵션을 탐색하여 어떤 유형의 추가 정보를 사용할 수 있는지도 살펴보세요. 

## 리소스 정리

연습을 마쳤으므로 불필요한 리소스 사용을 방지하기 위해 만든 클라우드 리소스를 삭제해야 합니다.

1. 브라우저에서 Azure Portal[https://portal.azure.com](https://portal.azure.com)로 이동한 다음, 메시지가 나타나면 Azure 자격 증명을 사용하여 로그인합니다.
1. 만든 리소스 그룹으로 이동하여 이 연습에 사용된 리소스의 내용을 봅니다.
1. 도구 모음에서 **리소스 그룹 삭제**를 선택합니다.
1. 리소스 그룹 이름을 입력하고 삭제할 것인지 확인합니다.

> **주의:** 리소스 그룹을 삭제하면 해당 리소스 그룹에 포함된 모든 리소스가 함께 삭제됩니다. 이 연습을 위해 기존 리소스 그룹을 선택한 경우, 이 연습의 범위와 관계없는 기존 리소스도 삭제됩니다.
